__author__ = 'Gabriel'
from skimage import data
from numpy import *
import pickle
from matplotlib.pyplot import *

"""
Viusalize the sorted thumbnails, tools to set cutoff by hand, and
finally generate a JSON File.
"""

def previewThumbs(thumbList, dims):
    thumbdir = 'D:\\memeproject\\thumbnails\\'
    pview = uint8(np.zeros((70*dims[0],70*dims[1],3)));
    for i in range(0,dims[0]*dims[1]):
        thumb = data.load(thumbdir + thumbList[i])[:,:,0:3]
        if thumb.shape[1] != 70:
            blankRight = uint8(zeros((thumb.shape[0], 70 - shape(thumb)[1],3)))
            thumb = concatenate((thumb, blankRight),axis=1)
        blankBottom = uint8(zeros((70 - shape(thumb)[0],70,3)))
        pthumb = concatenate((thumb, blankBottom))
        x = i/dims[1]
        y = i - dims[1]*(i/dims[1])
        pview[70*x:70*(x+1), 70*y:70*(y+1)] = pthumb

    # Generate Plot and assign callback on click
    # TODO: Make simple GUI to select relevant memes.
    thumbPlot = figure()
    ax = thumbPlot.add_subplot(111)
    ax.imshow(pview)
    def onclick(event):
        print 'button=%d, x=%d, y=%d, xdata=%f, ydata=%f'%(
            event.button, event.x, event.y, event.xdata, event.ydata)

    thumbPlot.canvas.mpl_connect('button_press_event', onclick)

# Read and visualize the sorted thumbnails generated by sortThumbs.py
fp = open('D:\\memeproject\\thumbssort\\Anti-Joke_Chicken_(Rooster).jpg','r')
(s, cutoff) = pickle.load(fp)
fp.close()

print cutoff
thumbList = [i[1] for i in s]
previewThumbs(thumbList, (50,50))
show()

print "hi"